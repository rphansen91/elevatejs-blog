{"componentChunkName":"component---src-templates-post-js","path":"/blog/mongo-backed-graphql/","result":{"data":{"markdownRemark":{"html":"<h1>Generate All CRUD and Pagination Operations (10 minutes or less)</h1>\n<p>GraphQL and its schema driven development methodology allows for a lot of the common tasks around data resources to be abstracted. </p>\n<p><a href=\"https://github.com/rphansen91/ts-mongo-codegen\">ts-mongo-codegen</a> uses your GraphQL schema and with the inclusion of (opt-in) directives generate all of the CRUD operations for the specified type.</p>\n<ul>\n<li>Insert Resource</li>\n<li>Insert Many Resources</li>\n<li>Find Resource By ObjectID</li>\n<li>Find Many Resources By ObjectIDs</li>\n<li>Paginated and Sorted Queries</li>\n<li>Filtered Totals</li>\n<li>Update Resource By ObjectID</li>\n<li>Update Many Resources By ObjectIDs</li>\n<li>Remove Resource By ObjectID</li>\n<li>Remove Many Resources By ObjectIDs</li>\n</ul>\n<p>With these basic yet useful patters generated it allows the developer to focus on how the end user interacts with the data. </p>\n<p>Less time as a result is spent doing error prone tasks like manipulating data types, and more time is spent delivering <em>visible</em> value.</p>\n<p><em>Let's move some mountains!</em></p>\n<p>You can follow along by forking the <a href=\"https://github.com/rphansen91/mountains-api\"><code>mountains-api</code></a>.</p>\n<p>Here is the <code>Mountain</code> type that we will be using and augmenting today.</p>\n<h2>Type Defs</h2>\n<pre><code class=\"language-javascript\">import gql from 'graphql-tag'\n\nexport const mountainSchema = gql`\n  type Mountain @collection(name: \"mountains\", crud: true) {\n    id: ObjectId\n    name: String @insert @set @filter\n    meters: Float @insert @set @filter\n    feet: Float @insert @set @filter\n    location: String @insert @set @filter\n  }\n`\n</code></pre>\n<h2>Directives</h2>\n<h3>@collection</h3>\n<p>With this directive declared <a href=\"https://github.com/rphansen91/ts-mongo-codegen\">ts-mongo-codegen</a> will generate interfaces and factory functions that can be made executable when starting the GraphQL server.</p>\n<h4>Options</h4>\n<ul>\n<li>name: The name of the mongo collection</li>\n<li>crud: Should generate crud types and resolvers</li>\n</ul>\n<h3>@insert</h3>\n<p>The <code>@insert</code> directive tells <a href=\"https://github.com/rphansen91/ts-mongo-codegen\">ts-mongo-codegen</a> which fields should be included in the <strong>C</strong>REATE types.</p>\n<h3>@filter</h3>\n<p>The <code>@filter</code> directive tells <a href=\"https://github.com/rphansen91/ts-mongo-codegen\">ts-mongo-codegen</a> which fields should be included in the <strong>R</strong>EAD types.</p>\n<h3>@set</h3>\n<p>The <code>@set</code> directive tells <a href=\"https://github.com/rphansen91/ts-mongo-codegen\">ts-mongo-codegen</a> which fields should be included in the <strong>U</strong>PDATE types.</p>\n<h2>Generate</h2>\n<p>Now that we have our <code>Mountain</code> type defined. We will set up our <code>codegen.json</code> which defines the options for our GraphQL Codegen. More documentation can be found <a href=\"https://graphql-code-generator.com/\">here</a>.</p>\n<pre><code class=\"language-json\">{\n  \"schema\": [\"./node_modules/ts-mongo-codegen/dist/types/mongo-types.ts\", \"./src/gql/*.ts\"],\n  \"generates\": {\n    \"./src/types.generated.ts\": {\n      \"plugins\": [\n        \"typescript\",\n        \"typescript-operations\",\n        \"typescript-resolvers\",\n        \"ts-mongo-codegen\"\n      ]\n    }\n  }\n}\n</code></pre>\n<p>With the code generated we can put it all together into an executable schema.</p>\n<pre><code class=\"language-javascript\">import { makeExecutableSchema } from '@graphql-tools/schema'\nimport { addResolveFunctionsToSchema } from 'apollo-server'\nimport { graphqlTypeDate, graphqlTypeObjectId, makeAugmentedSchema, mongoTypeDefs } from 'ts-mongo-codegen'\nimport { mountainMutationResolvers, mountainQueryResolvers, mountainResolvers } from './types.generated'\nimport { composeResolvers } from '@graphql-tools/resolvers-composition'\nimport { mountainSchema } from './gql/mountains'\nimport { isAuthenticated } from './auth'\n\n// Make an executable schema with the mongo types and our custom mountain schema type\nconst executableSchema = makeExecutableSchema({\n  typeDefs: [mongoTypeDefs, mountainSchema],\n})\n\n// Add CRUD operations to the Mountain type by augmenting the schema\nexport const schema = makeAugmentedSchema(executableSchema)\n\n// The mountainResolvers, mountainMutationResolvers, and mountainQueryResolvers are generated types\n// Run `yarn generate` to update types or add more\nconst resolvers = composeResolvers(\n  {\n    Date: graphqlTypeDate,\n    Mountain: mountainResolvers,\n    Mutation: {\n      ...mountainMutationResolvers,\n    },\n    ObjectId: graphqlTypeObjectId,\n    Query: {\n      ...mountainQueryResolvers,\n    },\n  },\n  {\n    // Make sure mutation requests are authenticated\n    Mutation: [isAuthenticated()],\n  }\n)\n\n// Finally we add our generated resolvers to the schema\naddResolveFunctionsToSchema({\n  resolvers,\n  schema,\n})\n</code></pre>\n<h2><strong>C</strong>REATE</h2>\n<h2>Insert Resource</h2>\n<iframe alt=\"Insert Resource Playground\" src=\"https://graphqlbin.com/v2/K6LYt8\" width=\"100%\" height=\"800px\" frameborder=\"0\"></iframe>\n<h2>Insert Many Resources</h2>\n<iframe alt=\"Insert Many Resources Playground\" src=\"https://graphqlbin.com/v2/PYz6Ho\" width=\"100%\" height=\"800px\" frameborder=\"0\"></iframe>\n<h2><strong>R</strong>EAD</h2>\n<h3>Find Resource By ObjectID</h3>\n<iframe alt=\"Find Resource By ObjectID Playground\" src=\"https://graphqlbin.com/v2/RLP5iQ\" width=\"100%\" height=\"800px\" frameborder=\"0\"></iframe>\n<h3>Find Many Resources By ObjectIDs</h3>\n<iframe alt=\"Find Many Resources By ObjectIDs Playground\" src=\"https://graphqlbin.com/v2/N8YpcV\" width=\"100%\" height=\"800px\" frameborder=\"0\"></iframe>\n<h3>Paginated and Sorted Queries</h3>\n<iframe alt=\"Paginated and Sorted Playground\" src=\"https://www.graphqlbin.com/v2/JPNNFK\" width=\"100%\" height=\"800px\" frameborder=\"0\"></iframe>\n<h3>Filtered Totals</h3>\n<iframe alt=\"Filtered Totals Playground\" src=\"https://graphqlbin.com/v2/QO6jho\" width=\"100%\" height=\"800px\" frameborder=\"0\"></iframe>\n<h2><strong>U</strong>PDATE</h2>\n<h3>Update Resource By ObjectID</h3>\n<iframe alt=\"Update Resource By ObjectID Playground\" src=\"https://graphqlbin.com/v2/W8QohP\" width=\"100%\" height=\"800px\" frameborder=\"0\"></iframe>\n<h3>Update Many Resources By ObjectIDs</h3>\n<iframe alt=\"Update Many Resources By ObjectIDs Playground\" src=\"https://graphqlbin.com/v2/ZWzXuX\" width=\"100%\" height=\"800px\" frameborder=\"0\"></iframe>\n<h2><strong>D</strong>ELETE</h2>\n<h3>Remove Resource By ObjectID</h3>\n<iframe alt=\"Remove Resource By ObjectID Playground\" src=\"https://graphqlbin.com/v2/OZPXsp\" width=\"100%\" height=\"800px\" frameborder=\"0\"></iframe>\n<h3>Remove Many Resources By ObjectIDs</h3>\n<iframe alt=\"Remove Many Resources By ObjectIDs Playground\" src=\"https://graphqlbin.com/v2/YMyxuA\" width=\"100%\" height=\"800px\" frameborder=\"0\"></iframe>","frontmatter":{"publishedAt":"June 29, 2020","title":"Generate All CRUD and Pagination Operations (10 minutes or less)","description":"With these basic yet useful patters generated it allows the developer to focus on how the end user interacts with the data.","author":"Ryan P. Hansen","urlToImage":{"childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAYDBAX/xAAVAQEBAAAAAAAAAAAAAAAAAAAAAv/aAAwDAQACEAMQAAABLONANArE1//EABoQAAMBAAMAAAAAAAAAAAAAAAABAhEDEyH/2gAIAQEAAQUCVYTypHbJTPcbP//EABYRAQEBAAAAAAAAAAAAAAAAAAARAf/aAAgBAwEBPwGrj//EABYRAQEBAAAAAAAAAAAAAAAAAAARAf/aAAgBAgEBPwGJr//EABgQAAMBAQAAAAAAAAAAAAAAAAAQITHh/9oACAEBAAY/AqdUhq//xAAbEAEAAgIDAAAAAAAAAAAAAAABACERMUFRof/aAAgBAQABPyHkcwi8QdvpLBsxBGxHcUan/9oADAMBAAIAAwAAABAbL//EABcRAQADAAAAAAAAAAAAAAAAAAARUWH/2gAIAQMBAT8QhTJ//8QAFhEBAQEAAAAAAAAAAAAAAAAAAGFx/9oACAECAQE/ENLP/8QAGxABAAMBAQEBAAAAAAAAAAAAAQARMSFRYaH/2gAIAQEAAT8Q2ATKUfyBVKtvo82DKQPjKgyxdHpFJYSi7EJj72f/2Q==","aspectRatio":1.501466275659824,"src":"/static/71f8efa83ffbfd440ed7a71b0ea6fd92/0ff54/nepal.jpg","srcSet":"/static/71f8efa83ffbfd440ed7a71b0ea6fd92/89b9c/nepal.jpg 512w,\n/static/71f8efa83ffbfd440ed7a71b0ea6fd92/26852/nepal.jpg 1024w,\n/static/71f8efa83ffbfd440ed7a71b0ea6fd92/0ff54/nepal.jpg 1200w","sizes":"(max-width: 1200px) 100vw, 1200px"}}},"sourceName":"TS Mongo Codegen","path":"/blog/mongo-backed-graphql/"}}},"pageContext":{}}}