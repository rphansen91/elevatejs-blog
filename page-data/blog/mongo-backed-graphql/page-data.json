{"componentChunkName":"component---src-templates-post-js","path":"/blog/mongo-backed-graphql/","result":{"data":{"markdownRemark":{"html":"<h1>Generate All CRUD and Pagination Operations (10 minutes or less)</h1>\n<p>GraphQL and its schema driven development methodology allows for a lot of the common tasks around data resources to be abstracted. </p>\n<p><a href=\"https://github.com/rphansen91/ts-mongo-codegen\"><strong>ts-mongo-codegen</strong></a> uses your GraphQL schema and with the inclusion of (opt-in) directives generates all of the CRUD operations for a seamless integration between GraphQL types and MongoDB.</p>\n<ul>\n<li>Insert Resource <code class=\"language-text\">insertMountain</code></li>\n<li>Insert Many Resources <code class=\"language-text\">insertManyMountains</code></li>\n<li>Find Resource By ObjectID <code class=\"language-text\">findMountainById</code></li>\n<li>Find Many Resources By ObjectIDs <code class=\"language-text\">findMountainsByIds</code></li>\n<li>Paginated and Sorted Queries <code class=\"language-text\">findMountains</code></li>\n<li>Filtered Totals <code class=\"language-text\">findMountains</code></li>\n<li>Update Resource By ObjectID <code class=\"language-text\">updateMountain</code></li>\n<li>Update Many Resources By ObjectIDs <code class=\"language-text\">updateManyMountains</code></li>\n<li>Remove Resource By ObjectID <code class=\"language-text\">removeMountain</code></li>\n<li>Remove Many Resources By ObjectIDs <code class=\"language-text\">removeManyMountains</code></li>\n</ul>\n<p>With these basic yet useful patters generated it allows the developer to focus on how the end user interacts with the data. </p>\n<p>Less time as a result is spent doing error prone tasks like manipulating data types, and more time is spent delivering <em>visible</em> value.</p>\n<p><em>Let's move some mountains!</em></p>\n<p>You can follow along by forking the <a href=\"https://github.com/rphansen91/mountains-api\"><strong>mountains-api</strong></a>.</p>\n<p>Here is the <code class=\"language-text\">Mountain</code> type that we will be using and augmenting today.</p>\n<h2>Type Defs</h2>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> gql <span class=\"token keyword\">from</span> <span class=\"token string\">'graphql-tag'</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> mountainSchema <span class=\"token operator\">=</span> gql<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n  type Mountain @collection(name: \"mountains\", crud: true) {\n    id: ObjectId\n    name: String @insert @set @filter\n    meters: Float @insert @set @filter\n    feet: Float @insert @set @filter\n    location: String @insert @set @filter\n  }\n</span><span class=\"token template-punctuation string\">`</span></span></code></pre></div>\n<h2>Directives</h2>\n<h3>@collection</h3>\n<p>With this directive declared <a href=\"https://github.com/rphansen91/ts-mongo-codegen\"><strong>ts-mongo-codegen</strong></a> will generate interfaces and factory functions that can be made executable when starting the GraphQL server.</p>\n<h4>Options</h4>\n<ul>\n<li>name: The name of the mongo collection</li>\n<li>crud: Should generate crud types and resolvers</li>\n</ul>\n<h3>@insert</h3>\n<p>The <code class=\"language-text\">@insert</code> directive tells <a href=\"https://github.com/rphansen91/ts-mongo-codegen\"><strong>ts-mongo-codegen</strong></a> which fields should be included in the <strong>C</strong>REATE types.</p>\n<h3>@filter</h3>\n<p>The <code class=\"language-text\">@filter</code> directive tells <a href=\"https://github.com/rphansen91/ts-mongo-codegen\"><strong>ts-mongo-codegen</strong></a> which fields should be included in the <strong>R</strong>EAD types.</p>\n<h3>@set</h3>\n<p>The <code class=\"language-text\">@set</code> directive tells <a href=\"https://github.com/rphansen91/ts-mongo-codegen\"><strong>ts-mongo-codegen</strong></a> which fields should be included in the <strong>U</strong>PDATE types.</p>\n<h2>Generate</h2>\n<p>Now that we have our <code class=\"language-text\">Mountain</code> type defined. We will set up our <code class=\"language-text\">codegen.json</code> which defines the options for our GraphQL Codegen. More documentation can be found <a href=\"https://graphql-code-generator.com/\">here</a>.</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"schema\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"./node_modules/ts-mongo-codegen/dist/types/mongo-types.ts\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"./src/gql/*.ts\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"generates\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"./src/types.generated.ts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"plugins\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token string\">\"typescript\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"typescript-operations\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"typescript-resolvers\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"ts-mongo-codegen\"</span>\n      <span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>With the code generated we can put it all together into an executable schema.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> makeExecutableSchema <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@graphql-tools/schema'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> addResolveFunctionsToSchema <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'apollo-server'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> graphqlTypeDate<span class=\"token punctuation\">,</span> graphqlTypeObjectId<span class=\"token punctuation\">,</span> makeAugmentedSchema<span class=\"token punctuation\">,</span> mongoTypeDefs <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'ts-mongo-codegen'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> mountainMutationResolvers<span class=\"token punctuation\">,</span> mountainQueryResolvers<span class=\"token punctuation\">,</span> mountainResolvers <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./types.generated'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> composeResolvers <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@graphql-tools/resolvers-composition'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> mountainSchema <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./gql/mountains'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> isAuthenticated <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./auth'</span>\n\n<span class=\"token comment\">// Make an executable schema with the mongo types and our custom mountain schema type</span>\n<span class=\"token keyword\">const</span> executableSchema <span class=\"token operator\">=</span> <span class=\"token function\">makeExecutableSchema</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  typeDefs<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>mongoTypeDefs<span class=\"token punctuation\">,</span> mountainSchema<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// Add CRUD operations to the Mountain type by augmenting the schema</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> schema <span class=\"token operator\">=</span> <span class=\"token function\">makeAugmentedSchema</span><span class=\"token punctuation\">(</span>executableSchema<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// The mountainResolvers, mountainMutationResolvers, and mountainQueryResolvers are generated types</span>\n<span class=\"token comment\">// Run `yarn generate` to update types or add more</span>\n<span class=\"token keyword\">const</span> resolvers <span class=\"token operator\">=</span> <span class=\"token function\">composeResolvers</span><span class=\"token punctuation\">(</span>\n  <span class=\"token punctuation\">{</span>\n    Date<span class=\"token operator\">:</span> graphqlTypeDate<span class=\"token punctuation\">,</span>\n    Mountain<span class=\"token operator\">:</span> mountainResolvers<span class=\"token punctuation\">,</span>\n    Mutation<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token operator\">...</span>mountainMutationResolvers<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    ObjectId<span class=\"token operator\">:</span> graphqlTypeObjectId<span class=\"token punctuation\">,</span>\n    Query<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token operator\">...</span>mountainQueryResolvers<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Make sure mutation requests are authenticated</span>\n    Mutation<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token function\">isAuthenticated</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// Finally we add our generated resolvers to the schema</span>\n<span class=\"token function\">addResolveFunctionsToSchema</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  resolvers<span class=\"token punctuation\">,</span>\n  schema<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>And with that we are done. We can view our results in the GraphQL playground.</p>\n<h2>Playground</h2>\n<iframe alt=\"Mountain API Playground\" src=\"https://graphqlbin.com/v2/lp21tA\" width=\"100%\" height=\"800px\" frameborder=\"0\"></iframe>\n<!-- ## **C**REATE\n\n## Insert Resource\n\n<iframe alt=\"Insert Resource Playground\" src=\"https://graphqlbin.com/v2/K6LYt8\" width=\"100%\" height=\"800px\" frameborder=\"0\"></iframe>\n\n## Insert Many Resources\n\n<iframe alt=\"Insert Many Resources Playground\" src=\"https://graphqlbin.com/v2/PYz6Ho\" width=\"100%\" height=\"800px\" frameborder=\"0\"></iframe>\n\n## **R**EAD\n\n### Find Resource By ObjectID\n\n<iframe alt=\"Find Resource By ObjectID Playground\" src=\"https://graphqlbin.com/v2/RLP5iQ\" width=\"100%\" height=\"800px\" frameborder=\"0\"></iframe>\n\n### Find Many Resources By ObjectIDs\n\n<iframe alt=\"Find Many Resources By ObjectIDs Playground\" src=\"https://graphqlbin.com/v2/N8YpcV\" width=\"100%\" height=\"800px\" frameborder=\"0\"></iframe>\n\n### Paginated and Sorted Queries\n\n<iframe alt=\"Paginated and Sorted Playground\" src=\"https://www.graphqlbin.com/v2/JPNNFK\" width=\"100%\" height=\"800px\" frameborder=\"0\"></iframe>\n\n### Filtered Totals\n\n<iframe alt=\"Filtered Totals Playground\" src=\"https://graphqlbin.com/v2/QO6jho\" width=\"100%\" height=\"800px\" frameborder=\"0\"></iframe>\n\n## **U**PDATE\n\n### Update Resource By ObjectID\n\n<iframe alt=\"Update Resource By ObjectID Playground\" src=\"https://graphqlbin.com/v2/W8QohP\" width=\"100%\" height=\"800px\" frameborder=\"0\"></iframe>\n\n### Update Many Resources By ObjectIDs\n\n<iframe alt=\"Update Many Resources By ObjectIDs Playground\" src=\"https://graphqlbin.com/v2/ZWzXuX\" width=\"100%\" height=\"800px\" frameborder=\"0\"></iframe>\n\n## **D**ELETE\n\n### Remove Resource By ObjectID\n\n<iframe alt=\"Remove Resource By ObjectID Playground\" src=\"https://graphqlbin.com/v2/OZPXsp\" width=\"100%\" height=\"800px\" frameborder=\"0\"></iframe>\n\n### Remove Many Resources By ObjectIDs\n\n<iframe alt=\"Remove Many Resources By ObjectIDs Playground\" src=\"https://graphqlbin.com/v2/YMyxuA\" width=\"100%\" height=\"800px\" frameborder=\"0\"></iframe> -->\n<h2>Conclusion</h2>\n<p>In this post we generated all of the basic CRUD operations with very little effort. Our clients whether that be web or mobile will now have a very predictable backend backed by MongoDB.</p>\n<p>In this article we did not go into creating the context dependency necessary for the resolvers. We will go over that in a different post but if you are interested can find the implementation <a href=\"https://github.com/rphansen91/mountains-api/blob/master/src/context.ts\"><strong>here</strong></a>.</p>","frontmatter":{"publishedAt":"June 29, 2020","title":"Generate GraphQL MongoDB CRUD and Pagination Operations (10 minutes or less)","description":"Use your GraphQL types to automatically generate CRUD operations for a seamless integration between your schema and MongoDB.","author":"Ryan P. Hansen","urlToImage":{"childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAYDBAX/xAAVAQEBAAAAAAAAAAAAAAAAAAAAAv/aAAwDAQACEAMQAAABLONANArE1//EABoQAAMBAAMAAAAAAAAAAAAAAAABAhEDEyH/2gAIAQEAAQUCVYTypHbJTPcbP//EABYRAQEBAAAAAAAAAAAAAAAAAAARAf/aAAgBAwEBPwGrj//EABYRAQEBAAAAAAAAAAAAAAAAAAARAf/aAAgBAgEBPwGJr//EABgQAAMBAQAAAAAAAAAAAAAAAAAQITHh/9oACAEBAAY/AqdUhq//xAAbEAEAAgIDAAAAAAAAAAAAAAABACERMUFRof/aAAgBAQABPyHkcwi8QdvpLBsxBGxHcUan/9oADAMBAAIAAwAAABAbL//EABcRAQADAAAAAAAAAAAAAAAAAAARUWH/2gAIAQMBAT8QhTJ//8QAFhEBAQEAAAAAAAAAAAAAAAAAAGFx/9oACAECAQE/ENLP/8QAGxABAAMBAQEBAAAAAAAAAAAAAQARMSFRYaH/2gAIAQEAAT8Q2ATKUfyBVKtvo82DKQPjKgyxdHpFJYSi7EJj72f/2Q==","aspectRatio":1.501466275659824,"src":"/static/71f8efa83ffbfd440ed7a71b0ea6fd92/0ff54/nepal.jpg","srcSet":"/static/71f8efa83ffbfd440ed7a71b0ea6fd92/89b9c/nepal.jpg 512w,\n/static/71f8efa83ffbfd440ed7a71b0ea6fd92/26852/nepal.jpg 1024w,\n/static/71f8efa83ffbfd440ed7a71b0ea6fd92/0ff54/nepal.jpg 1200w","sizes":"(max-width: 1200px) 100vw, 1200px"}}},"sourceName":"TS Mongo Codegen","path":"/blog/mongo-backed-graphql/"}}},"pageContext":{}}}